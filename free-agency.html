<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Free Agency Tracker - Owner Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --dark-gold: #B8941E;
            --black: #0A0A0A;
            --off-black: #1A1A1A;
            --charcoal: #2A2A2A;
            --silver: #C0C0C0;
            --white: #FFFFFF;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Oswald', sans-serif;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: rgba(212,175,55,0.05); }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 2px; }

        /* ---- Header ---- */
        .tracker-header {
            background: linear-gradient(135deg, var(--off-black) 0%, var(--charcoal) 100%);
            border-bottom: 2px solid var(--gold);
            padding: 0.55rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            flex-wrap: wrap;
            flex-shrink: 0;
        }
        .tracker-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.25rem;
            color: var(--gold);
            letter-spacing: 0.1em;
            flex: 1;
            white-space: nowrap;
        }
        .back-btn {
            background: transparent;
            border: 1.5px solid var(--gold);
            color: var(--gold);
            font-family: 'Oswald', sans-serif;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.32rem 0.65rem;
            border-radius: 4px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            flex-shrink: 0;
        }
        .back-btn:hover { background: rgba(212,175,55,0.1); }
        .league-select {
            background: var(--charcoal);
            border: 1.5px solid rgba(212,175,55,0.4);
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 0.76rem;
            padding: 0.32rem 0.55rem;
            border-radius: 4px;
            cursor: pointer;
            max-width: 200px;
        }
        .header-user {
            color: var(--silver);
            font-size: 0.63rem;
            opacity: 0.5;
            white-space: nowrap;
        }

        /* ---- Three-column grid ---- */
        .tracker-grid {
            display: grid;
            grid-template-columns: 1fr 437px 1fr;
            height: calc(100vh - 46px);
            overflow: hidden;
            gap: 0.6rem;
            padding: 0.6rem;
            box-sizing: border-box;
        }
        @media (max-width: 900px) {
            .tracker-grid { grid-template-columns: 1fr; height: auto; overflow: visible; }
        }

        /* ---- Panels ---- */
        .panel {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: rgba(10,10,10,0.85);
            border: 2px solid rgba(212,175,55,0.2);
            border-radius: 10px;
        }
        .panel-header {
            background: rgba(212,175,55,0.07);
            border-bottom: 1px solid rgba(212,175,55,0.18);
            border-radius: 10px 10px 0 0;
            font-family: 'Bebas Neue', cursive;
            font-size: 1.3rem;
            color: var(--gold);
            letter-spacing: 0.1em;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }
        .ph-title {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0 0.7rem;
            height: 50px;
            overflow: hidden;
            flex-shrink: 0;
            white-space: nowrap;
        }
        /* Second row of each panel-header — fixed height for cross-column alignment */
        .ph-sub {
            display: flex;
            align-items: center;
            gap: 0.2rem;
            padding: 0 0.5rem;
            height: 36px;
            overflow: hidden;
            border-top: 1px solid rgba(212,175,55,0.1);
            flex-shrink: 0;
        }
        .panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 0.4rem 0.45rem;
        }

        /* ---- Stats column header row ---- */
        .stat-col-hdr {
            display: flex;
            align-items: center;
            padding: 0.18rem 0.85rem;
            gap: 0.35rem;
            border-bottom: 1px solid rgba(212,175,55,0.1);
            flex-shrink: 0;
        }
        .stat-lbl {
            font-family: 'Bebas Neue', cursive;
            font-size: 0.72rem;
            color: var(--gold);
            letter-spacing: 0.07em;
            opacity: 0.7;
            text-align: right;
            flex-shrink: 0;
        }

        /* ---- Position badge ---- */
        .pos-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 34px;
            flex-shrink: 0;
            font-size: 0.62rem;
            font-weight: 700;
            border: 1.5px solid var(--gold);
            border-radius: 3px;
            padding: 2px 0;
            background: rgba(212,175,55,0.08);
            letter-spacing: 0.02em;
        }

        /* ---- Player rows (compact) ---- */
        .player-row {
            display: flex;
            align-items: center;
            padding: 0.22rem 0.3rem;
            margin-bottom: 0.15rem;
            background: rgba(255,255,255,0.02);
            border-radius: 4px;
            gap: 0.35rem;
            transition: background 0.12s;
        }
        .player-row:hover { background: rgba(212,175,55,0.06); }
        .player-name {
            flex: 0 0 160px;
            width: 160px;
            font-size: 1.1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: inherit;
            text-decoration: none;
            display: block;
        }
        .player-team {
            font-size: 0.68rem;
            color: var(--silver);
            opacity: 0.5;
        }
        /* Stat cell */
        .sc {
            font-size: 0.72rem;
            font-weight: 600;
            text-align: right;
            flex-shrink: 0;
        }
        .pos-group-label {
            font-family: 'Bebas Neue', cursive;
            font-size: 0.76rem;
            color: var(--gold);
            letter-spacing: 0.1em;
            padding: 0.38rem 0 0.14rem;
            opacity: 0.72;
        }

        /* ---- Center: filter buttons + search (inside .ph-sub) ---- */
        .filter-btn {
            background: transparent;
            border: 1px solid rgba(212,175,55,0.27);
            color: var(--silver);
            font-family: 'Oswald', sans-serif;
            font-size: 0.67rem;
            font-weight: 600;
            padding: 0.18rem 0.4rem;
            border-radius: 3px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            transition: all 0.1s;
        }
        .filter-btn.active { background: var(--gold); border-color: var(--gold); color: var(--black); }
        .search-input {
            flex: 0 1 90px;
            min-width: 50px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(212,175,55,0.27);
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 0.76rem;
            padding: 0.18rem 0.42rem;
            border-radius: 3px;
        }
        .search-input::placeholder { color: rgba(192,192,192,0.33); }
        .search-input:focus { outline: none; border-color: rgba(212,175,55,0.58); }
        .add-circle {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: 1px solid rgba(212,175,55,0.52);
            background: transparent;
            color: var(--gold);
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.1s;
        }
        .add-circle:hover { background: var(--gold); color: var(--black); }

        /* ---- Quick-add bar ---- */
        .quick-add-bar {
            padding: 0.4rem 0.5rem;
            background: rgba(212,175,55,0.07);
            border-bottom: 1px solid rgba(212,175,55,0.26);
            flex-shrink: 0;
        }

        /* ---- Roster Table (My Roster panel) ---- */
        .roster-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        .roster-table thead th {
            position: static;
            background: rgba(10,10,10,0.97);
            color: var(--gold);
            padding: 0.32rem 0.45rem;
            font-family: 'Bebas Neue', cursive;
            font-size: 0.72rem;
            font-weight: 400;
            letter-spacing: 0.07em;
            border-bottom: 1px solid rgba(212,175,55,0.18);
            text-align: right;
        }
        .roster-table thead th.rth-pos    { text-align: center; width: 44px; }
        .roster-table thead th.rth-player { text-align: left; }
        .roster-table thead th.rth-yrs    { width: 40px; }
        .roster-table thead th.rth-pts    { width: 56px; }
        .roster-table thead th.rth-gp     { width: 36px; }
        .roster-table thead th.rth-avg    { width: 52px; }
        .roster-table thead th.rth-proj   { width: 48px; opacity: 0.6; }
        .roster-table td {
            padding: 0.27rem 0.45rem;
            vertical-align: middle;
            text-align: right;
            font-size: 0.72rem;
            font-weight: 600;
            border: none;
        }
        .roster-table td.rtd-pos {
            text-align: center;
            width: 44px;
            font-family: 'Bebas Neue', cursive;
            font-size: 0.68rem;
            font-weight: 400;
            color: var(--gold);
            background: rgba(212,175,55,0.13);
            letter-spacing: 0.04em;
        }
        .roster-table td.rtd-player {
            text-align: left;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            font-size: 0.82rem;
        }
        .roster-table td.rtd-player a {
            color: var(--white);
            text-decoration: none;
        }
        .roster-table td.rtd-player a:hover { color: var(--gold); }
        .roster-table td.rtd-num  { color: var(--silver); opacity: 0.75; }
        .roster-table td.rtd-pts  { color: var(--gold); opacity: 1; }
        .roster-table td.rtd-proj { color: var(--silver); opacity: 0.5; }
        /* Group header row */
        .roster-table tr.rt-group td {
            background: rgba(8,8,8,0.95);
            color: var(--gold);
            font-family: 'Bebas Neue', cursive;
            font-size: 0.75rem;
            letter-spacing: 0.08em;
            padding: 0.28rem 0.45rem;
            border-bottom: 1px solid rgba(212,175,55,0.12);
            text-align: left;
            opacity: 1;
        }
        .roster-table tr.rt-group .rt-gw {
            display: flex;
            justify-content: space-between;
        }
        /* Separator row */
        .roster-table tr.rt-sep td {
            background: rgba(212,175,55,0.07);
            height: 2px;
            padding: 0;
        }
        /* Status colors on player cell */
        .roster-table td.ps-starter { background: rgba(6,78,59,0.55);   color: #ecfdf5 !important; opacity:1 !important; }
        .roster-table td.ps-ir      { background: rgba(127,29,29,0.55); color: #fee2e2 !important; opacity:1 !important; }
        .roster-table td.ps-taxi    { background: rgba(49,46,129,0.55);  color: #e0e7ff !important; opacity:1 !important; }
        /* Row hover */
        .roster-table tbody tr:not(.rt-group):not(.rt-sep):hover td { background: rgba(212,175,55,0.07); }
        .roster-table tbody tr:not(.rt-group):not(.rt-sep):hover td.rtd-pos { background: rgba(212,175,55,0.22); }

        /* ---- Right: FA Targets ---- */
        .budget-input-inline {
            background: transparent;
            border: none;
            border-bottom: 1.5px solid var(--gold);
            color: var(--gold);
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            width: 90px;
            text-align: right;
        }
        .budget-input-inline:focus { outline: none; }
        .t-input {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(212,175,55,0.2);
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 0.68rem;
            padding: 0.25rem 0.35rem;
            border-radius: 3px;
            min-width: 0;
        }
        .t-input::placeholder { color: rgba(192,192,192,0.28); }
        .t-input:focus { outline: none; border-color: rgba(212,175,55,0.52); }
        .t-submit {
            background: var(--gold);
            border: none;
            color: var(--black);
            font-family: 'Oswald', sans-serif;
            font-size: 0.66rem;
            font-weight: 700;
            padding: 0.25rem 0.52rem;
            border-radius: 3px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* ---- Targets rows (div-based, shares player-row layout) ---- */
        .del-btn {
            background: transparent;
            border: none;
            color: rgba(231,76,60,0.52);
            cursor: pointer;
            font-size: 0.82rem;
            padding: 0 0.12rem;
            line-height: 1;
        }
        .del-btn:hover { color: #E74C3C; }

        /* ---- States ---- */
        .center-msg { text-align: center; color: var(--silver); opacity: 0.5; padding: 2rem 1rem; font-size: 0.78rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // ===== AUTH =====
        const AUTH_KEY = 'od_auth_v1';
        const authRaw = localStorage.getItem(AUTH_KEY);
        if (!authRaw) window.location.href = 'login.html';
        let sleeperUsername = '';
        try {
            sleeperUsername = JSON.parse(authRaw).username || '';
        } catch (e) {
            localStorage.removeItem(AUTH_KEY);
            window.location.href = 'login.html';
        }

        // ===== SLEEPER API =====
        const SLEEPER_BASE = 'https://api.sleeper.app/v1';
        async function apiFetch(url) {
            const r = await fetch(url);
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            return r.json();
        }
        const fetchUser       = u       => apiFetch(`${SLEEPER_BASE}/user/${encodeURIComponent(u)}`);
        const fetchLeagues    = (uid,yr) => apiFetch(`${SLEEPER_BASE}/user/${uid}/leagues/nfl/${yr}`);
        const fetchRosters    = id      => apiFetch(`${SLEEPER_BASE}/league/${id}/rosters`);
        const fetchLeagueInfo = id      => apiFetch(`${SLEEPER_BASE}/league/${id}`);

        let _playersCache = null;
        async function fetchPlayers() {
            if (_playersCache) return _playersCache;
            _playersCache = await apiFetch(`${SLEEPER_BASE}/players/nfl`);
            return _playersCache;
        }

        let _statsCache = {};
        async function fetchSeasonStats(season) {
            if (_statsCache[season]) return _statsCache[season];
            try {
                _statsCache[season] = await apiFetch(`${SLEEPER_BASE}/stats/nfl/regular/${season}`);
            } catch (e) {
                console.warn('Stats fetch failed for', season, e);
                _statsCache[season] = {};
            }
            return _statsCache[season];
        }

        // ===== CONSTANTS =====
        // Current league year; stats pulled from the prior completed season
        const SEASON      = '2026';
        const STATS_YEAR  = '2025';
        const FA_KEY      = id => `od_fa_targets_v1_${id}`;

        const POS_COLORS = {
            QB:'#FF6B6B', RB:'#4ECDC4', WR:'#45B7D1', TE:'#F7DC6F',
            K:'#BB8FCE',  DEF:'#85929E', LB:'#F0A500', DL:'#E67E22',
            DB:'#5DADE2', CB:'#5DADE2', S:'#5DADE2', SS:'#5DADE2', FS:'#5DADE2',
            DE:'#E67E22', DT:'#E67E22', NT:'#E67E22', OLB:'#F0A500',
            ILB:'#F0A500', MLB:'#F0A500'
        };
        const posColor = p => POS_COLORS[p] || 'var(--silver)';

        function normPos(pos) {
            if (!pos) return null;
            if (['DB','CB','S','SS','FS'].includes(pos)) return 'DB';
            if (['DL','DE','DT','NT','IDL','EDGE'].includes(pos)) return 'DL';
            if (['LB','OLB','ILB','MLB'].includes(pos)) return 'LB';
            return pos;
        }
        const POS_ORDER = { QB:0, RB:1, WR:2, TE:3, K:4, DEF:5, DL:5, LB:6, DB:7 };
        const posOrder  = pos => POS_ORDER[normPos(pos)] ?? 9;

        // Base sets — overridden per-league below
        const IDP_POS_FILTERS = ['ALL','RK','QB','RB','WR','TE','K','LB','DL','DB'];
        const DEF_POS_FILTERS = ['ALL','RK','QB','RB','WR','TE','K','DEF'];
        const IDP_RELEVANT = new Set([
            'QB','RB','WR','TE','K',
            'LB','OLB','ILB','MLB',
            'DL','DE','DT','NT','IDL','EDGE',
            'DB','CB','S','SS','FS'
        ]);
        const DEF_RELEVANT = new Set(['QB','RB','WR','TE','K','DEF']);

        // Shared stat column widths (px)
        const SW = { yrs:24, pts:34, gp:22, avg:32, proj:38 };

        // ===== TARGET STORAGE =====
        function loadTargets(leagueId) {
            try {
                const raw = localStorage.getItem(FA_KEY(leagueId));
                return raw ? JSON.parse(raw) : { startingBudget: 1000, targets: [] };
            } catch (e) {
                return { startingBudget: 1000, targets: [] };
            }
        }
        function saveTargets(leagueId, data) {
            localStorage.setItem(FA_KEY(leagueId), JSON.stringify(data));
        }

        // ===== APP =====
        function FreeAgencyTracker() {
            const [phase, setPhase]   = useState('boot');
            const [errMsg, setErrMsg] = useState('');
            const [userId, setUserId] = useState('');
            const [userAvatar, setUserAvatar] = useState('');
            const [nflWeek, setNflWeek]       = useState(null);
            const [projStats, setProjStats]   = useState({});
            const projInFlight = useRef(new Set());
            const [leagues, setLeagues]   = useState([]);
            const [leagueId, setLeagueId] = useState('');

            const [leagueInfo, setLeagueInfo]     = useState(null);
            const [myRoster, setMyRoster]         = useState(null);
            const [allRosters, setAllRosters]     = useState([]);
            const [playersData, setPlayersData]   = useState({});
            const [statsData, setStatsData]       = useState({});
            const [leagueLoading, setLeagueLoading] = useState(false);

            const [posFilter, setPosFilter] = useState('ALL');
            const [search, setSearch]       = useState('');

            const [targets, setTargets]               = useState([]);
            const [startingBudget, setStartingBudget] = useState(1000);
            const [editingBudget, setEditingBudget]   = useState(false);
            const [budgetDraft, setBudgetDraft]       = useState('1000');

            const [fPos, setFPos]   = useState('');
            const [fName, setFName] = useState('');
            const [fCost, setFCost] = useState('');

            const [quickPlayer, setQuickPlayer]   = useState(null);
            const [quickCost, setQuickCost]       = useState('');
            const [dropTarget, setDropTarget]     = useState(false);
            const [editingCostId, setEditingCostId] = useState(null);
            const [editingCostVal, setEditingCostVal] = useState('');

            // ---- Bootstrap ----
            useEffect(() => { boot(); }, []);

            async function boot() {
                try {
                    const [user, nflState] = await Promise.all([
                        fetchUser(sleeperUsername),
                        apiFetch('https://api.sleeper.app/v1/state/nfl'),
                    ]);
                    setUserId(user.user_id);
                    if (user.avatar) setUserAvatar(user.avatar);
                    setNflWeek(Number(nflState?.week) || 1);
                    // Fetch 2026 leagues only
                    const lgs = await fetchLeagues(user.user_id, SEASON);
                    setLeagues(lgs || []);
                    if (lgs && lgs.length > 0) setLeagueId(lgs[0].league_id);
                    setPhase('ready');
                } catch (e) {
                    setErrMsg('Failed to connect to Sleeper. Check your network and try again.');
                    setPhase('error');
                }
            }

            useEffect(() => {
                if (!leagueId || !userId || phase !== 'ready') return;
                loadLeague();
            }, [leagueId, userId, phase]);

            async function loadLeague() {
                setLeagueLoading(true);
                setMyRoster(null);
                setAllRosters([]);
                setPlayersData({});
                setStatsData({});
                setPosFilter('ALL');
                setSearch('');
                try {
                    // Fetch rosters, league info, players, and 2025 season stats in parallel
                    const [rosters, info, players, stats] = await Promise.all([
                        fetchRosters(leagueId),
                        fetchLeagueInfo(leagueId),
                        fetchPlayers(),
                        fetchSeasonStats(STATS_YEAR)
                    ]);
                    const myR = rosters.find(r => r.owner_id === userId) || null;
                    setMyRoster(myR);
                    setAllRosters(rosters);
                    setLeagueInfo(info);
                    setPlayersData(players);
                    setStatsData(stats);

                    const saved = loadTargets(leagueId);
                    setTargets(saved.targets || []);

                    // Use total FAAB budget for the season as starting point
                    const totalBudget = info?.settings?.waiver_budget || 0;
                    if (totalBudget > 0) {
                        const budgetToUse = saved.startingBudget !== 1000
                            ? saved.startingBudget
                            : totalBudget;
                        setStartingBudget(budgetToUse);
                        setBudgetDraft(String(budgetToUse));
                    } else {
                        setStartingBudget(saved.startingBudget || 1000);
                        setBudgetDraft(String(saved.startingBudget || 1000));
                    }
                } catch (e) {
                    console.error('League load failed:', e);
                } finally {
                    setLeagueLoading(false);
                }
            }

            useEffect(() => {
                if (!leagueId) return;
                saveTargets(leagueId, { startingBudget, targets });
            }, [targets, startingBudget, leagueId]);

            // ---- Helpers ----

            // Compute fantasy pts using the league's actual scoring_settings weights,
            // applied to raw stat fields — works for both offensive and IDP players.
            // Mirrors the Team Comps page's fantasyPointsFromScoring() approach:
            // always use scoring_settings when available so IDP defensive stats aren't
            // silently zeroed out by Sleeper's pre-calculated pts_half_ppr = 0.
            function calcRawPts(s) {
                if (!s) return null;
                const scoring = leagueInfo?.scoring_settings;
                if (scoring) {
                    let total = 0;
                    for (const [field, weight] of Object.entries(scoring)) {
                        if (typeof weight !== 'number') continue;
                        if (s[field] != null) total += Number(s[field]) * weight;
                    }
                    return total;
                }
                // Fallback: Sleeper's pre-calculated totals (offensive players only)
                const pre = s.pts_half_ppr ?? s.pts_ppr ?? s.pts_std ?? null;
                return pre !== null ? Number(pre) : null;
            }

            // Raw pts for sorting (returns -1 when no data so players with data sort above those without)
            function getPts(id) {
                const s = statsData[id];
                if (!s) return -1;
                const raw = calcRawPts(s);
                return raw !== null ? raw : -1;
            }

            // FantasyPros player page URL derived from full name
            function fpUrl(name) {
                if (!name) return null;
                const slug = name
                    .toLowerCase()
                    .replace(/['\u2019.]/g, '')
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/-+/g, '-')
                    .replace(/^-|-$/g, '');
                return `https://www.fantasypros.com/nfl/players/${slug}.php`;
            }

            function getStats(playerId) {
                const player = playersData[playerId];
                const s = statsData[playerId];
                const yrs = player?.years_exp != null ? player.years_exp : '-';
                const rawPts = calcRawPts(s);
                const pts = rawPts !== null ? Number(rawPts).toFixed(1) : '-';
                const gp  = s?.gp != null ? s.gp : '-';
                const avg = (rawPts !== null && s?.gp && s.gp > 0)
                    ? (rawPts / s.gp).toFixed(1) : '-';
                return { yrs, pts, gp, avg };
            }

            function rosterStatusClass(id) {
                if (!myRoster) return '';
                if ((myRoster.starters || []).includes(id)) return 'ps-starter';
                if ((myRoster.reserve  || []).includes(id)) return 'ps-ir';
                if ((myRoster.taxi     || []).includes(id)) return 'ps-taxi';
                return '';
            }

            function getProj(pid) {
                const p = String(pid);
                if (!nflWeek || !leagueInfo) return '';
                const cached = projStats[p];
                if (cached !== undefined) {
                    if (cached === null) return '—';
                    const pts = calcRawPts(cached);
                    return pts ? Number(pts).toFixed(1) : '0.0';
                }
                if (!projInFlight.current.has(p)) {
                    projInFlight.current.add(p);
                    apiFetch(`${SLEEPER_BASE}/projections/nfl/player/${p}?season_type=regular&season=${SEASON}&week=${nflWeek}`)
                        .then(data => {
                            const stats = data?.stats && typeof data.stats === 'object' ? data.stats : data;
                            setProjStats(prev => ({ ...prev, [p]: (stats && typeof stats === 'object') ? stats : null }));
                        })
                        .catch(() => setProjStats(prev => ({ ...prev, [p]: null })))
                        .finally(() => projInFlight.current.delete(p));
                }
                return '…';
            }

            // ---- Derived data ----
            const takenIds = useMemo(() =>
                new Set(allRosters.flatMap(r => r.players || [])),
                [allRosters]
            );

            // Detect league type from roster_positions: DEF = team defense, otherwise IDP
            const isIDP = useMemo(() => {
                const rp = leagueInfo?.roster_positions || [];
                return !rp.includes('DEF');
            }, [leagueInfo]);

            const posFilters    = isIDP ? IDP_POS_FILTERS : DEF_POS_FILTERS;
            const relevantPosSet = isIDP ? IDP_RELEVANT    : DEF_RELEVANT;

            // Section color lookup: playerId → { border, bg }
            const sectionMap = useMemo(() => {
                const map = new Map();
                if (!myRoster) return map;
                const starterSet = new Set(myRoster.starters || []);
                const reserveSet = new Set(myRoster.reserve  || []);
                const taxiSet    = new Set(myRoster.taxi     || []);
                for (const id of myRoster.players || []) {
                    if      (starterSet.has(id)) map.set(id, { border:'var(--gold)', bg:'rgba(212,175,55,0.05)'  });
                    else if (reserveSet.has(id)) map.set(id, { border:'#E74C3C',     bg:'rgba(231,76,60,0.05)'   });
                    else if (taxiSet.has(id))    map.set(id, { border:'#3498DB',     bg:'rgba(52,152,219,0.05)'  });
                    else                         map.set(id, { border:null,          bg:'rgba(255,255,255,0.02)' });
                }
                return map;
            }, [myRoster]);

            // Position-grouped roster for layout
            const myGrouped = useMemo(() => {
                if (!myRoster?.players || !Object.keys(playersData).length) return {};
                const g = {};
                for (const id of myRoster.players) {
                    const p = playersData[id];
                    if (!p) continue;
                    const grp = normPos(p.position) || 'Other';
                    if (!g[grp]) g[grp] = [];
                    g[grp].push({ id, p });
                }
                for (const grp of Object.keys(g)) {
                    g[grp].sort((a, b) => getPts(b.id) - getPts(a.id));
                }
                return g;
            }, [myRoster, playersData, statsData]);
            const myGroups = Object.keys(myGrouped).sort((a, b) => posOrder(a) - posOrder(b));

            const freeAgents = useMemo(() => {
                if (!Object.keys(playersData).length || !allRosters.length) return [];
                return Object.entries(playersData)
                    .filter(([id, p]) =>
                        !takenIds.has(id) &&
                        p.team &&
                        p.team.trim() !== '' &&
                        relevantPosSet.has(p.position)
                    )
                    .map(([id, p]) => ({
                        id,
                        name: p.full_name || `${p.first_name||''} ${p.last_name||''}`.trim() || id,
                        pos: p.position,
                        norm: normPos(p.position),
                        team: p.team,
                        yrsExp: p.years_exp ?? null
                    }))
                    .sort((a, b) => {
                        const posOrd = posOrder(a.pos) - posOrder(b.pos);
                        if (posOrd !== 0) return posOrd;
                        // Within the same position group, highest pts first
                        return getPts(b.id) - getPts(a.id);
                    });
            }, [playersData, takenIds, statsData, isIDP]);

            const filteredFAs = useMemo(() => {
                const list = freeAgents.filter(fa => {
                    let posOk;
                    if (posFilter === 'ALL')       posOk = true;
                    else if (posFilter === 'RK')   posOk = fa.yrsExp === 0;
                    else                           posOk = fa.norm === posFilter || fa.pos === posFilter;
                    const q      = search.toLowerCase();
                    const srchOk = !q || fa.name.toLowerCase().includes(q) || (fa.team||'').toLowerCase().includes(q);
                    return posOk && srchOk;
                });
                // ALL and RK views: rank purely by total points, no position grouping
                if (posFilter === 'ALL' || posFilter === 'RK') {
                    list.sort((a, b) => getPts(b.id) - getPts(a.id));
                }
                return list;
            }, [freeAgents, posFilter, search, statsData]);

            const targetRows = useMemo(() => {
                let bal = startingBudget;
                return targets.map(t => {
                    const before = bal;
                    const after  = before - t.cost;
                    bal = after;
                    return { ...t, faDollar: before, remaining: after };
                });
            }, [targets, startingBudget]);

            const finalBalance = targetRows.length > 0
                ? targetRows[targetRows.length - 1].remaining
                : startingBudget;

            // ---- Handlers ----
            function addTarget(pos, name, cost) {
                const c = parseInt(cost);
                if (!name.trim() || isNaN(c) || c < 0) return;
                setTargets(prev => [...prev, {
                    id: Date.now().toString(),
                    pos: (pos || '?').toUpperCase(),
                    name: name.trim(),
                    cost: c
                }]);
            }
            function deleteTarget(id) { setTargets(prev => prev.filter(t => t.id !== id)); }
            function updateTargetCost(id, val) {
                const c = parseInt(val);
                if (isNaN(c) || c < 0) return;
                setTargets(prev => prev.map(t => t.id === id ? { ...t, cost: c } : t));
            }
            function handleFormAdd(e) {
                e.preventDefault();
                addTarget(fPos, fName, fCost);
                setFPos(''); setFName(''); setFCost('');
            }
            function handleQuickAdd(e) {
                e.preventDefault();
                if (!quickPlayer) return;
                addTarget(quickPlayer.norm || quickPlayer.pos, quickPlayer.name, quickCost);
                setQuickPlayer(null); setQuickCost('');
            }
            function commitBudget() {
                const v = parseInt(budgetDraft);
                if (!isNaN(v) && v >= 0) setStartingBudget(v);
                setEditingBudget(false);
            }
            function remColor(val) {
                if (val < 0) return '#E74C3C';
                if (val < startingBudget * 0.1)  return '#E67E22';
                if (val < startingBudget * 0.25) return '#F0A500';
                return '#2ECC71';
            }

            // ---- Boot/error states ----
            if (phase === 'boot') return (
                <div style={{ minHeight:'100vh', display:'flex', alignItems:'center', justifyContent:'center', flexDirection:'column', gap:'0.75rem' }}>
                    <div style={{ color:'var(--gold)', fontFamily:'Bebas Neue,cursive', fontSize:'1.4rem', letterSpacing:'0.12em' }}>LOADING FREE AGENCY TRACKER</div>
                    <div style={{ color:'var(--silver)', fontSize:'0.75rem', opacity:0.6 }}>Connecting to Sleeper API...</div>
                </div>
            );
            if (phase === 'error') return (
                <div style={{ minHeight:'100vh', display:'flex', alignItems:'center', justifyContent:'center', padding:'2rem' }}>
                    <div style={{ textAlign:'center' }}>
                        <div style={{ color:'#E74C3C', marginBottom:'1rem', fontSize:'0.9rem' }}>{errMsg}</div>
                        <button onClick={() => window.location.href='index.html'}
                            style={{ padding:'0.5rem 1.2rem', background:'var(--gold)', border:'none', borderRadius:'4px',
                                     cursor:'pointer', fontFamily:'Oswald,sans-serif', fontWeight:700, fontSize:'0.85rem' }}>
                            &larr; Back to Dashboard
                        </button>
                    </div>
                </div>
            );

            // Shared stat column header row used by both panels
            function StatHeader({ addBtn }) {
                return (
                    <div className="stat-col-hdr">
                        <span style={{ width:'34px', flexShrink:0 }}></span>
                        <span style={{ width:'160px', flexShrink:0 }}></span>
                        <span className="stat-lbl" style={{ width:`${SW.yrs}px` }}>YRS</span>
                        <span className="stat-lbl" style={{ width:`${SW.pts}px` }}>PTS</span>
                        <span className="stat-lbl" style={{ width:`${SW.gp}px` }}>GP</span>
                        <span className="stat-lbl" style={{ width:`${SW.avg}px` }}>AVG</span>
                        <span className="stat-lbl" style={{ width:`${SW.proj}px`, opacity:0.5 }}>PROJ</span>
                        {addBtn && <span style={{ width:'20px' }}></span>}
                    </div>
                );
            }

            // ---- Main render ----
            return (
                <div style={{ display:'flex', flexDirection:'column', height:'100vh', overflow:'hidden' }}>

                    {/* HEADER */}
                    <div className="tracker-header">
                        <button className="back-btn" onClick={() => window.location.href='index.html'}>&larr; Dashboard</button>
                        <div className="tracker-title">&#9889; FREE AGENCY TRACKER &mdash; 2026</div>
                        <select className="league-select" value={leagueId} onChange={e => setLeagueId(e.target.value)}>
                            {leagues.map(l => <option key={l.league_id} value={l.league_id}>{l.name}</option>)}
                        </select>
                        <span className="header-user">{sleeperUsername}</span>
                    </div>

                    {leagueLoading ? (
                        <div className="center-msg" style={{ paddingTop:'4rem' }}>Loading league data...</div>
                    ) : (
                        <div className="tracker-grid">

                            {/* ===== LEFT: MY ROSTER ===== */}
                            <div className="panel roster-panel">
                                <div className="panel-header">
                                    <div className="ph-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                            <circle cx="12" cy="8" r="4"/><path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                                        </svg>
                                        MY ROSTER
                                        {myRoster && (
                                            <span style={{ color:'var(--silver)', fontSize:'1.3rem', marginLeft:'0.4rem' }}>
                                                ({myRoster.settings?.wins || 0}-{myRoster.settings?.losses || 0}{(myRoster.settings?.ties || 0) > 0 ? `-${myRoster.settings.ties}` : ''})
                                            </span>
                                        )}
                                        {userAvatar && (
                                            <img
                                                src={`https://sleepercdn.com/avatars/thumbs/${userAvatar}`}
                                                alt=""
                                                style={{ width:'30px', height:'30px', borderRadius:'5px', flexShrink:0, marginLeft:'0.3rem' }}
                                            />
                                        )}
                                        {myRoster && (
                                            <span style={{ marginLeft:'auto', color:'var(--silver)', fontSize:'0.58rem', opacity:0.5 }}>
                                                {myRoster.players?.length || 0} players
                                            </span>
                                        )}
                                    </div>
                                    <div className="ph-sub"></div>
                                </div>
                                {myGroups.length > 0 && (
                                    <table className="roster-table" style={{flexShrink:0}}>
                                        <thead>
                                            <tr>
                                                <th className="rth-pos">POS</th>
                                                <th className="rth-player">PLAYER</th>
                                                <th className="rth-yrs">YRS</th>
                                                <th className="rth-pts">PTS</th>
                                                <th className="rth-gp">GP</th>
                                                <th className="rth-avg">AVG</th>
                                                <th className="rth-proj">PROJ</th>
                                            </tr>
                                        </thead>
                                    </table>
                                )}
                                <div className="panel-body" style={{padding:0}}>
                                    {myGroups.length === 0 && <div className="center-msg">No roster data</div>}
                                    {myGroups.length > 0 && (
                                        <table className="roster-table">
                                            <colgroup>
                                                <col style={{width:'44px'}}/>
                                                <col/>
                                                <col style={{width:'40px'}}/>
                                                <col style={{width:'56px'}}/>
                                                <col style={{width:'36px'}}/>
                                                <col style={{width:'52px'}}/>
                                                <col style={{width:'48px'}}/>
                                            </colgroup>
                                            <tbody>
                                                {myGroups.flatMap(grp => [
                                                    <tr key={`${grp}-hdr`} className="rt-group">
                                                        <td colSpan={7}>
                                                            <div className="rt-gw">
                                                                <span>{grp}</span>
                                                                <span>({myGrouped[grp].length})</span>
                                                            </div>
                                                        </td>
                                                    </tr>,
                                                    ...myGrouped[grp].map(({ id, p }) => {
                                                        const st = getStats(id);
                                                        const pName = p.full_name || `${p.first_name||''} ${p.last_name||''}`.trim() || id;
                                                        const url = fpUrl(pName);
                                                        const sc = rosterStatusClass(id);
                                                        return (
                                                            <tr key={id}>
                                                                <td className="rtd-pos">{p.position || '?'}</td>
                                                                <td className={`rtd-player${sc ? ' '+sc : ''}`}>
                                                                    <a href={url || '#'} target="_blank" rel="noopener noreferrer">
                                                                        {pName}
                                                                        <span style={{fontSize:'0.65rem', color:'var(--silver)', opacity:0.55, marginLeft:'0.3rem'}}>{p.team||''}</span>
                                                                    </a>
                                                                </td>
                                                                <td className="rtd-num">{st.yrs}</td>
                                                                <td className="rtd-num rtd-pts">{st.pts}</td>
                                                                <td className="rtd-num">{st.gp}</td>
                                                                <td className="rtd-num">{st.avg}</td>
                                                                <td className="rtd-num rtd-proj">{getProj(id)}</td>
                                                            </tr>
                                                        );
                                                    }),
                                                    <tr key={`${grp}-sep`} className="rt-sep"><td colSpan={7}></td></tr>,
                                                ])}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>

                            {/* ===== CENTER: FREE AGENTS ===== */}
                            <div className="panel">
                                <div className="panel-header">
                                    <div className="ph-title">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                        </svg>
                                        AVAILABLE FREE AGENTS
                                        <span style={{ color:'var(--silver)', fontSize:'0.65rem', opacity:0.55, marginLeft:'auto' }}>{filteredFAs.length}</span>
                                    </div>
                                    <div className="ph-sub">
                                        {posFilters.map(p => (
                                            <button key={p} className={`filter-btn${posFilter===p?' active':''}`}
                                                onClick={() => setPosFilter(p)}>{p}</button>
                                        ))}
                                        <input className="search-input" placeholder="Search..."
                                            value={search} onChange={e => setSearch(e.target.value)} />
                                    </div>
                                </div>

                                {/* Quick-add bar */}
                                {quickPlayer && (
                                    <div className="quick-add-bar">
                                        <form onSubmit={handleQuickAdd} style={{ display:'flex', alignItems:'center', gap:'0.4rem' }}>
                                            <span style={{ flex:1, color:'var(--gold)', fontSize:'0.73rem',
                                                           overflow:'hidden', textOverflow:'ellipsis', whiteSpace:'nowrap' }}>
                                                + <strong>{quickPlayer.name}</strong>
                                                <span style={{ color:'var(--silver)', opacity:0.55 }}> ({quickPlayer.norm||quickPlayer.pos})</span>
                                            </span>
                                            <input className="t-input" style={{ width:'68px' }} type="number"
                                                placeholder="Bid $" value={quickCost}
                                                onChange={e => setQuickCost(e.target.value)} autoFocus min="0" />
                                            <button type="submit" className="t-submit">Add</button>
                                            <button type="button" onClick={() => setQuickPlayer(null)}
                                                style={{ background:'transparent', border:'none', color:'var(--silver)',
                                                         cursor:'pointer', fontSize:'1.1rem', lineHeight:1 }}>&times;</button>
                                        </form>
                                    </div>
                                )}

                                <StatHeader addBtn={true} />

                                <div className="panel-body">
                                    {filteredFAs.length === 0 && (
                                        <div className="center-msg">
                                            {Object.keys(playersData).length === 0 ? 'Loading player data...' : 'No free agents found'}
                                        </div>
                                    )}
                                    {filteredFAs.map(fa => {
                                        const st = getStats(fa.id);
                                        const url = fpUrl(fa.name);
                                        return (
                                            <div key={fa.id} className="player-row"
                                                draggable="true"
                                                onDragStart={e => { e.dataTransfer.effectAllowed='copy'; e.dataTransfer.setData('fa-id', fa.id); }}
                                                onClick={() => { setQuickPlayer(fa); setQuickCost(''); }}>
                                                <span className="pos-badge" style={{ color: posColor(fa.pos) }}>
                                                    {fa.pos}
                                                </span>
                                                <a className="player-name" href={url || '#'} target="_blank" rel="noopener noreferrer"
                                                    onClick={e => e.stopPropagation()}
                                                    onMouseEnter={e => e.currentTarget.style.color='var(--gold)'}
                                                    onMouseLeave={e => e.currentTarget.style.color='inherit'}>
                                                    {fa.name} <span className="player-team">{fa.team}</span>
                                                </a>
                                                <span className="sc" style={{ width:`${SW.yrs}px`, color:'var(--silver)', opacity:0.65 }}>{st.yrs}</span>
                                                <span className="sc" style={{ width:`${SW.pts}px`, color:'var(--gold)' }}>{st.pts}</span>
                                                <span className="sc" style={{ width:`${SW.gp}px`, color:'var(--silver)', opacity:0.65 }}>{st.gp}</span>
                                                <span className="sc" style={{ width:`${SW.avg}px`, color:'var(--silver)', opacity:0.65 }}>{st.avg}</span>
                                                <span className="sc" style={{ width:`${SW.proj}px`, color:'var(--silver)', opacity:0.45 }}>{getProj(fa.id)}</span>
                                                <span className="add-circle" title="Add to targets">+</span>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* ===== RIGHT: FA TARGETS ===== */}
                            <div className="panel">
                                <div className="panel-header">
                                    <div className="ph-title">
                                        FA TARGETS
                                        {editingBudget ? (
                                            <input className="budget-input-inline"
                                                style={{ marginLeft:'auto', fontSize:'0.78rem', width:'90px' }}
                                                type="number" min="0"
                                                value={budgetDraft}
                                                onChange={e => setBudgetDraft(e.target.value)}
                                                onBlur={commitBudget}
                                                onKeyDown={e => e.key === 'Enter' && commitBudget()}
                                                autoFocus />
                                        ) : (
                                            <span title="Click to edit total FAAB budget"
                                                onClick={() => { setEditingBudget(true); setBudgetDraft(String(startingBudget)); }}
                                                style={{ marginLeft:'auto', color: remColor(finalBalance),
                                                         fontSize:'0.78rem', fontWeight:700, cursor:'pointer',
                                                         fontFamily:'monospace', letterSpacing:0, flexShrink:0 }}>
                                                Available FAAB ${finalBalance.toLocaleString()}
                                            </span>
                                        )}
                                    </div>
                                    {/* Add form lives in ph-sub so all three panel-headers are the same height */}
                                    <div className="ph-sub" style={{ gap:'0.22rem' }}>
                                        <form onSubmit={handleFormAdd} style={{ display:'flex', alignItems:'center', gap:'0.22rem', width:'100%' }}>
                                            <input className="t-input" style={{ width:'36px' }} placeholder="POS"
                                                value={fPos} onChange={e => setFPos(e.target.value)} maxLength={3} />
                                            <input className="t-input" style={{ flex:1 }} placeholder="Player name"
                                                value={fName} onChange={e => setFName(e.target.value)} />
                                            <input className="t-input" style={{ width:'44px' }} type="number"
                                                placeholder="$" value={fCost} min="0"
                                                onChange={e => setFCost(e.target.value)} />
                                            <button type="submit" className="t-submit">+ Add</button>
                                        </form>
                                    </div>
                                </div>

                                {/* Column header row — sits at same level as stat-col-hdr in other panels */}
                                <div className="stat-col-hdr" style={{ padding:'0.18rem 0.38rem' }}>
                                    <span style={{ width:'30px', flexShrink:0 }}></span>
                                    <span style={{ flex:1, minWidth:0 }}></span>
                                    <span className="stat-lbl" style={{ width:'30px' }}>COST</span>
                                    <span className="stat-lbl" style={{ width:'32px' }}>FA$</span>
                                    <span className="stat-lbl" style={{ width:'38px' }}>REM.</span>
                                    <span style={{ width:'20px', flexShrink:0 }}></span>
                                </div>

                                {/* Targets list — div-based rows matching left/center player-row layout */}
                                <div className="panel-body" style={{ padding:'0.4rem 0.38rem',
                                        outline: dropTarget ? '2px dashed rgba(212,175,55,0.6)' : 'none',
                                        outlineOffset: '-3px',
                                        transition: 'outline 0.1s' }}
                                    onDragOver={e => { e.preventDefault(); e.dataTransfer.dropEffect='copy'; setDropTarget(true); }}
                                    onDragLeave={() => setDropTarget(false)}
                                    onDrop={e => {
                                        e.preventDefault();
                                        setDropTarget(false);
                                        const id = e.dataTransfer.getData('fa-id');
                                        const fa = filteredFAs.find(f => f.id === id);
                                        if (fa) {
                                            const newId = Date.now().toString();
                                            setTargets(prev => [...prev, {
                                                id: newId,
                                                pos: (fa.norm || fa.pos || '?').toUpperCase(),
                                                name: fa.name,
                                                cost: 0
                                            }]);
                                            setEditingCostId(newId);
                                            setEditingCostVal('');
                                        }
                                    }}>
                                    {targetRows.length === 0 && (
                                        <div className="center-msg">{dropTarget ? 'Drop to add target' : 'Drag a free agent here or use the form above'}</div>
                                    )}
                                    {targetRows.map(row => (
                                        <div key={row.id} className="player-row">
                                            <span className="pos-badge"
                                                style={{ color:posColor(row.pos), width:'30px', fontSize:'0.58rem', flexShrink:0 }}>
                                                {row.pos}
                                            </span>
                                            <span className="player-name" style={{ fontSize:'0.82rem' }} title={row.name}>
                                                {row.name}
                                            </span>
                                            {editingCostId === row.id ? (
                                                <input type="number" min="0" autoFocus
                                                    value={editingCostVal}
                                                    onChange={e => setEditingCostVal(e.target.value)}
                                                    onBlur={() => { updateTargetCost(row.id, editingCostVal || '0'); setEditingCostId(null); }}
                                                    onKeyDown={e => {
                                                        if (e.key === 'Enter') { updateTargetCost(row.id, editingCostVal || '0'); setEditingCostId(null); }
                                                        if (e.key === 'Escape') setEditingCostId(null);
                                                    }}
                                                    style={{ width:'30px', background:'transparent', border:'1px solid rgba(212,175,55,0.5)',
                                                             borderRadius:'3px', color:'var(--gold)', fontSize:'0.72rem',
                                                             textAlign:'right', padding:'0 2px', outline:'none' }} />
                                            ) : (
                                                <span className="sc" title="Click to edit bid"
                                                    onClick={() => { setEditingCostId(row.id); setEditingCostVal(String(row.cost)); }}
                                                    style={{ width:'30px', color: row.cost === 0 ? 'rgba(212,175,55,0.4)' : 'var(--silver)',
                                                             opacity: row.cost === 0 ? 1 : 0.65, cursor:'pointer' }}>
                                                    {row.cost === 0 ? '$?' : row.cost}
                                                </span>
                                            )}
                                            <span className="sc" style={{ width:'32px', color:'var(--silver)', opacity:0.65 }}>{row.faDollar.toLocaleString()}</span>
                                            <span className="sc" style={{ width:'38px', color:remColor(row.remaining), fontWeight:700 }}>{row.remaining.toLocaleString()}</span>
                                            <button className="del-btn" onClick={() => deleteTarget(row.id)} title="Remove">&times;</button>
                                        </div>
                                    ))}
                                    {targetRows.length > 0 && (
                                        <div style={{ display:'flex', alignItems:'center', gap:'0.35rem',
                                                      padding:'0.26rem 0.3rem', marginTop:'0.2rem',
                                                      borderTop:'1.5px solid rgba(212,175,55,0.33)' }}>
                                            <span style={{ flex:1, fontFamily:'Bebas Neue,cursive', fontSize:'0.7rem',
                                                           color:'var(--gold)', letterSpacing:'0.06em',
                                                           textAlign:'right', paddingRight:'0.3rem' }}>
                                                BALANCE REMAINING
                                            </span>
                                            <span className="sc" style={{ width:'38px', color:remColor(finalBalance), fontWeight:700 }}>
                                                {finalBalance.toLocaleString()}
                                            </span>
                                            <span style={{ width:'20px', flexShrink:0 }}></span>
                                        </div>
                                    )}
                                </div>
                            </div>

                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<FreeAgencyTracker />);
    </script>
</body>
</html>
